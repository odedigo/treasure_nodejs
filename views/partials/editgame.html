<main id="main">
  <form id="gameEditor">

    <!-- GAME EDIT SECTION -->
      <section id="contact" class="contact section-bg">
      <div class="container">
        <h2>עריכת משחק {{data.gameName}}</h2>
        
        {{#compare data.error '!==' ''}}
        <div class="errMsg" id="errMsg">{{data.error}}</div>
        {{/compare}}
        
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">שמירה</button>
        </div>

        <!-- TAB DEFINITIONS -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="gen-tab" data-bs-toggle="tab" data-bs-target="#gen" type="button" role="tab" aria-controls="gen" aria-selected="true">כללי</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="red-tab" data-bs-toggle="tab" data-bs-target="#red" type="button" role="tab" aria-controls="red" aria-selected="false">קב' אדומה</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="blue-tab" data-bs-toggle="tab" data-bs-target="#blue" type="button" role="tab" aria-controls="blue" aria-selected="false">קב' כחולה</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="green-tab" data-bs-toggle="tab" data-bs-target="#green" type="button" role="tab" aria-controls="green" aria-selected="false">קב' ירוקה</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="map-tab" data-bs-toggle="tab" data-bs-target="#map" type="button" role="tab" aria-controls="map" aria-selected="false">מפות</button>
          </li>
        </ul>

        <div class="tab-content" id="myTabContent">
          <!-- GENERAL TAB-->
          <div class="tab-pane fade show active shadow p-3 bg-body rounded ms-2 me-2" id="gen" role="tabpanel" aria-labelledby="gen-tab">                
            <div class="mb-3 w-25">
              <div class="mb-3">
                <label for="gameName" class="form-label">שם המשחק</label>
                <input type="input" class="form-control input-sm" id="gameName" placeholder="" value="{{game.gameName}}" readonly>
              </div>
              <div class="mb-3">
                <label for="branch" class="form-label">סניף</label>
                <input type="input" class="form-control input-sm" id="branch" value="{{game.branch}}" placeholder="" readonly>
              </div>
              <div class="mb-3 ">
                <label for="version" class="form-label">גרסה</label>
                <div class="d-flex">
                  <input type="input" class="form-control input-sm" id="version" value="{{game.version}}" placeholder="" readonly>
                  <button type="button" class="btn btn-success text-nowrap" onclick="increaseMajorVersion()">העלאת גרסה ראשית</button>
                </div>
              </div>
            </div>
          </div>
          <!-- ***************** RED TEAM ***************** -->
          <div class="tab-pane fade show" id="red" role="tabpanel" aria-labelledby="red-tab">
            <div class="row shadow p-3 ms-2 me-2 mb-2 bg-body rounded">
                <div class="mb-3 col">
                  <label for="teamRed" class="form-label">שם הקבוצה</label>
                  <input type="input" class="form-control input-sm" id="teamRed" placeholder="" value="{{game.red.team}}">
                </div>
                <div class="mb-3 col">
                  <label for="coloRed" class="form-label">צבע הקבוצה</label>
                  <input type="input" class="form-control input-sm text-center" id="colorRed" value="{{game.red.color}}" style="background-color:{{game.red.color}}" readonly>
                </div>
                <div class="mb-3 col">
                  <label for="bgColorRed" class="form-label">צבע רקע</label>
                  <input type="input" class="form-control input-sm text-center" id="bgColorRed" value="{{game.red.bgColor}}" style="background-color:{{game.red.bgColor}}" readonly>
                </div>
            </div>
              
            {{#each game.red.riddles as |rdl|}}
            <!-- RIDDLE -->
            <div class="ms-2 me-2 mb-2 row shadow p-3 bg-body rounded"><!--row-->
              <div class="col"><!--col-->
                <label for="riddlered{{rdl.index}}" class="form-label fw-bold fs-3">חידה {{rdl.index}}</label>
                <div class="d-flex">
                  <img src="/img/form/red{{rdl.index}}.png" style="width:55px; height:55px"/>
                  <textarea class="form-control" id="riddlered{{rdl.index}}" rows="8">{{rdl.text}}</textarea>
                </div>
                <div class="mb-3 w-100">
                  <div class="fw-bold">פתרון</div>
                  <div class="d-flex me-5">
                    1 <input type="number" class="form-control input-sm text-center" id="red{{rdl.index}}VecSize1" placeholder="אורך הוקטור הראשון" value="{{rdl.vecSize.[0]}}"> מטר
                      <input type="number" class="form-control input-sm text-center" id="red{{rdl.index}}VecAngle1" placeholder="כיוון הוקטור הראשון" value="{{rdl.vecAngle.[0]}}"> מעלות
                  </div>
                  <div class="d-flex me-5">
                    2 <input type="number" class="form-control input-sm text-center" id="red{{rdl.index}}VecSize2" placeholder="אורך הוקטור השני" value="{{rdl.vecSize.[1]}}"> מטר
                    <input type="number" class="form-control input-sm text-center" id="red{{rdl.index}}VecAngle2" placeholder="כיוון הוקטור השני" value="{{rdl.vecAngle.[1]}}"> מעלות
                  </div>
                  <div class="d-flex me-5">
                    3 <input type="number" class="form-control input-sm text-center" id="red{{rdl.index}}VecSize3" placeholder="אורך הוקטור השלישי" value="{{rdl.vecSize.[2]}}"> מטר
                    <input type="number" class="form-control input-sm text-center" id="red{{rdl.index}}VecAngle3" placeholder="כיוון הוקטור השלישי" value="{{rdl.vecAngle.[2]}}"> מעלות
                  </div>
                </div>
              </div> <!-- end col -->
              <div class="col"><!--col-->
                <div class="mb-3 d-flex">
                  <label for="redImg{{rdl.index}}" class="form-label fw-bold"></label><br/>
                  <a href="#" data-bs-toggle="modal" data-bs-target="#imgGalleryModal">
                    <img src="/img/rdl/{{rdl.img}}" class="img-thumbnail" alt="" id="thumbRed" style="max-height:400px">
                    <input type="hidden" id="redImg{{rdl.index}}" value="/img/rdl/{{rdl.img}}" />
                  </a>
                  
                </div>
              </div><!-- end col -->
            </div><!-- end row / END RIDDLE -->

            {{/each}}                        
          </div> <!-- END RED TEAM -->

            <!-- ***************** BLUE TEAM ***************** -->
            <div class="tab-pane fade" id="blue" role="tabpanel" aria-labelledby="blue-tab">
              <div class="row shadow p-3 ms-2 me-2 mb-2 bg-body rounded">
                <div class="mb-3 col">
                  <label for="teamBlue" class="form-label">שם הקבוצה</label>
                  <input type="input" class="form-control input-sm" id="teamBlue" placeholder="" value="{{game.blue.team}}">
                </div>
                <div class="mb-3 col">
                  <label for="colorBlue" class="form-label">צבע הקבוצה</label>
                  <input type="input" class="form-control input-sm text-center" id="colorBlue" value="{{game.blue.color}}" style="background-color:{{game.blue.color}}" readonly>
                </div>
                <div class="mb-3 col">
                  <label for="bgColorBlue" class="form-label">צבע רקע</label>
                  <input type="input" class="form-control input-sm text-center" id="bgColorBlue" value="{{game.blue.bgColor}}" style="background-color:{{game.blue.bgColor}}" readonly>
                </div>
            </div>
              
            {{#each game.blue.riddles as |rdl|}}
            <!-- RIDDLE -->
            <div class="ms-2 me-2 mb-2 row shadow p-3 bg-body rounded"><!--row-->
              <div class="col"><!--col-->
                <label for="riddleblue{{rdl.index}}" class="form-label fw-bold fs-3">חידה {{rdl.index}}</label>
                <div class="d-flex">
                  <img src="/img/form/blue{{rdl.index}}.png" style="width:55px; height:55px"/>
                  <textarea class="form-control" id="riddleblue{{rdl.index}}" rows="8">{{rdl.text}}</textarea>
                </div>
                <div class="mb-3 w-100">
                  <div class="fw-bold">פתרון</div>
                  <div class="d-flex me-5">
                    1 <input type="number" class="form-control input-sm text-center" id="blue{{rdl.index}}VecSize1" placeholder="אורך הוקטור הראשון" value="{{rdl.vecSize.[0]}}"> מטר
                      <input type="number" class="form-control input-sm text-center" id="blue{{rdl.index}}VecAngle1" placeholder="כיוון הוקטור הראשון" value="{{rdl.vecAngle.[0]}}"> מעלות
                  </div>
                  <div class="d-flex me-5">
                    2 <input type="number" class="form-control input-sm" id="blue{{rdl.index}}VecSize2" placeholder="אורך הוקטור השני" value="{{rdl.vecSize.[1]}}"> מטר
                    <input type="number" class="form-control input-sm text-center" id="blue{{rdl.index}}VecAngle2" placeholder="כיוון הוקטור השני" value="{{rdl.vecAngle.[1]}}"> מעלות
                  </div>
                  <div class="d-flex me-5">
                    3 <input type="number" class="form-control input-sm text-center" id="blue{{rdl.index}}VecSize3" placeholder="אורך הוקטור השלישי" value="{{rdl.vecSize.[2]}}"> מטר
                    <input type="number" class="form-control input-sm text-center" id="blue{{rdl.index}}VecAngle3" placeholder="כיוון הוקטור השלישי" value="{{rdl.vecAngle.[2]}}"> מעלות
                  </div>
                </div>
              </div> <!-- end col -->
              <div class="col"><!--col-->
                <div class="mb-3 d-flex">
                  <label for="blueImg{{rdl.index}}" class="form-label fw-bold"></label><br/>
                  <a href="#" data-bs-toggle="modal" data-bs-target="#imgGalleryModal">
                    <img src="/img/rdl/{{rdl.img}}" class="img-thumbnail" alt="" id="blueImg{{rdl.index}}" style="max-height:400px">
                    <input type="hidden" id="blueImg{{rdl.index}}" value="/img/rdl/{{rdl.img}}" />
                  </a>
                  
                </div>
              </div><!-- end col -->
            </div><!-- end row / END RIDDLE -->

            {{/each}}                
          </div> <!-- END BLUE TEAM -->

          <!-- ***************** GREEN TEAM ***************** -->
          <div class="tab-pane fade" id="green" role="tabpanel" aria-labelledby="green-tab">
            <div class="row shadow p-3 ms-2 me-2 mb-2 bg-body rounded">
              <div class="mb-3 col">
                <label for="teamGreen" class="form-label">שם הקבוצה</label>
                <input type="input" class="form-control input-sm" id="teamGreen" placeholder="" value="{{game.green.team}}">
              </div>
              <div class="mb-3 col">
                <label for="colorGreen" class="form-label">צבע הקבוצה</label>
                <input type="input" class="form-control input-sm text-center" id="colorGreen" value="{{game.green.color}}" style="background-color:{{game.green.color}}" readonly>
              </div>
              <div class="mb-3 col">
                <label for="bgColorGreen" class="form-label">צבע רקע</label>
                <input type="input" class="form-control input-sm text-center" id="bgColorGreen" value="{{game.green.bgColor}}" style="background-color:{{game.green.bgColor}}" readonly>
              </div>
          </div>
            
          {{#each game.green.riddles as |rdl|}}
          <!-- RIDDLE -->
          <div class="ms-2 me-2 mb-2 row shadow p-3 bg-body rounded"><!--row-->
            <div class="col"><!--col-->
              <label for="riddlegreen{{rdl.index}}" class="form-label fw-bold fs-3">חידה {{rdl.index}}</label>
              <div class="d-flex">
                <img src="/img/form/green{{rdl.index}}.png" style="width:55px; height:55px"/>
                <textarea class="form-control" id="riddlegreen{{rdl.index}}" rows="8">{{rdl.text}}</textarea>
              </div>
              <div class="mb-3 w-100">
                <div class="fw-bold">פתרון</div>
                <div class="d-flex me-5">
                  1 <input type="number" class="form-control input-sm text-center" id="green{{rdl.index}}VecSize1" placeholder="אורך הוקטור הראשון" value="{{rdl.vecSize.[0]}}"> מטר
                    <input type="number" class="form-control input-sm text-center" id="green{{rdl.index}}VecAngle1" placeholder="כיוון הוקטור הראשון" value="{{rdl.vecAngle.[0]}}"> מעלות
                </div>
                <div class="d-flex me-5">
                  2 <input type="number" class="form-control input-sm text-center" id="green{{rdl.index}}VecSize2" placeholder="אורך הוקטור השני" value="{{rdl.vecSize.[1]}}"> מטר
                  <input type="number" class="form-control input-sm" id="green{{rdl.index}}VecAngle2" placeholder="כיוון הוקטור השני" value="{{rdl.vecAngle.[1]}}"> מעלות
                </div>
                <div class="d-flex me-5">
                  3 <input type="number" class="form-control input-sm text-center" id="green{{rdl.index}}VecSize3" placeholder="אורך הוקטור השלישי" value="{{rdl.vecSize.[2]}}"> מטר
                  <input type="number" class="form-control input-sm" id="green{{rdl.index}}VecAngle3" placeholder="כיוון הוקטור השלישי" value="{{rdl.vecAngle.[2]}}"> מעלות
                </div>
              </div>
            </div> <!-- end col -->
            <div class="col"><!--col-->
              <div class="mb-3 d-flex">
                <label for="greenImg{{rdl.index}}" class="form-label fw-bold"></label><br/>
                <a href="#" data-bs-toggle="modal" data-bs-target="#imgGalleryModal">
                  <img src="/img/rdl/{{rdl.img}}" class="img-thumbnail" alt="" id="greenImg{{rdl.index}}" style="max-height:400px">
                  <input type="hidden" id="greenImg{{rdl.index}}" value="/img/rdl/{{rdl.img}}" />
                </a>
                
              </div>
            </div><!-- end col -->
          </div><!-- end row / END RIDDLE -->

          {{/each}}              
          </div> <!-- END GREEN TEAM -->

          <div class="tab-pane fade show active shadow p-3 bg-body rounded ms-2 me-2" id="map" role="tabpanel" aria-labelledby="map-tab"> 
          </div> 

        </div> <!-- END TAB -->

      </div> <!-- CONTAINER -->
    </section>
    <!-- END GAME EDIT SECTION -->
  </form> 


  <!-- IMAGE SELECTION MODAL -->
  <div class="modal fade" id="imgGalleryModal" tabindex="-1" aria-labelledby="imgGalleryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="imgGalleryModalLabel">בחירת תמונה</h5>              
        </div>
        <div class="modal-body modal-body-scrl">
            
          <!-- Page Content -->
          <div class="container">
            <div class="row text-center text-lg-start">

              {{#each imgs as |img|}}
              <div class="col-lg-3 col-md-4 col-6">
                <a href="#" class="d-block mb-4 h-100 aimage" onclick="markThumbnail(this)">
                  <img class="img-fluid img-thumbnail" src="/img/rdl/{{img}}" alt="" style="border: 1px solid lightGray" >
                </a>
              </div>
              {{/each}}
              
            </div>
          </div>
        </div>
        <div id="modalErrRoleMsg" class="errMsg">&nbsp;</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Close" id="closebut">סגירה</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="savebut" onclick="closeModalGameEdit('imgGalleryModal','save')">בחירה</button>
        </div>
      </div> <!-- MODAL CONTENT -->
    </div> <!-- MODAL DIALOG -->
  </div> <!-- END MODAL-->
  <!-- END IMAGE SELECTION MODAL -->

</main>

<script>
  /**
   * Handle modal 
   */
  var imgModal = document.getElementById('imgGalleryModal')
  let modalLink = null // used to save the link (a) from which it was opened
  imgModal.addEventListener('hide.bs.modal', function (event) {
  })  

  imgModal.addEventListener('show.bs.modal', function (event) {
    var link = event.relatedTarget
    modalLink = link // save link
    var imageName = getImageFilenameFromSrc(link.children[0].src)
    clearModalSelection()

    // Mark the currently selected (used) image
    var links = imgModal.querySelectorAll('a')
    if (links != null) {
      links.forEach(link => {
        if (link.children[0].src.indexOf(imageName) > -1)  { 
          link.children[0].style.border = "3px solid darkBlue"
        }
      })
    }
  })  
</script>